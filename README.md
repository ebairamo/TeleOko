# TeleOko - Система видеонаблюдения

TeleOko - это веб-приложение для видеонаблюдения, которое позволяет просматривать видеопотоки с камер Hikvision через браузер. Система преобразует RTSP-потоки в WebRTC для отображения в веб-браузере, а также позволяет просматривать архивные записи.

## Возможности

- Просмотр потоков с камер Hikvision в реальном времени
- Просмотр архивных записей
- Создание снимков с камер
- Временная шкала для навигации по архивным записям
- Поддержка нескольких каналов (камер)

## Требования

- Go 1.20 или выше
- Веб-браузер с поддержкой WebRTC (Chrome, Firefox, Safari, Edge)
- Доступ к IP-камерам Hikvision по сети

## Быстрый старт

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/teleoko.git
cd teleoko
```

2. Соберите и запустите приложение:
```bash
go build -o teleoko ./cmd/server
./teleoko
```

Для Windows:
```bash
go build -o teleoko.exe ./cmd/server
teleoko.exe
```

3. Откройте браузер и перейдите по адресу `http://localhost:8082`

## Изменение порта

По умолчанию сервер запускается на порту 8082. Вы можете изменить порт несколькими способами:

1. В файле конфигурации `config.json`:
```json
{
  "server": {
    "port": 8082  // Измените на нужный порт
  },
  ...
}
```

2. С помощью переменной среды:
```bash
PORT=3000 ./teleoko
```

3. С помощью аргумента командной строки:
```bash
./teleoko -port=3000
```

## Настройка

При первом запуске создается файл конфигурации `config.json` со следующими параметрами:

```json
{
  "server": {
    "port": 8082
  },
  "hikvision": {
    "ip": "192.168.1.64",
    "username": "admin",
    "password": "admin12345"
  },
  "auth": {
    "enabled": false,
    "username": "admin",
    "password": "admin"
  }
}
```

Отредактируйте этот файл, чтобы указать правильные данные для подключения к вашим камерам:

- `hikvision.ip` - IP-адрес вашего NVR или камеры Hikvision
- `hikvision.username` - имя пользователя для доступа к камере/NVR
- `hikvision.password` - пароль для доступа к камере/NVR

Если вы хотите включить базовую аутентификацию для доступа к веб-интерфейсу, установите `auth.enabled` в `true` и задайте имя пользователя и пароль.

## Подключение к камерам Hikvision

Для корректной работы системы необходимо:

1. Убедиться, что ваш компьютер имеет доступ к камерам или NVR Hikvision по сети
2. Проверить, что RTSP-порт (по умолчанию 554) открыт на камере/NVR
3. Правильно указать учетные данные для доступа в файле конфигурации

## Структура каналов

Для камер Hikvision обычно используются следующие форматы каналов:

- Для обычных камер: `101`, `102`, `103`, и т.д.
- Для потоков высокого качества: `1`, `2`, `3`, и т.д.
- Для потоков низкого качества (субпотоков): `101/1`, `102/1`, и т.д.

В веб-интерфейсе TeleOko вы можете выбрать нужный канал из выпадающего списка.

## Запуск в сети

Чтобы сделать систему доступной из сети интернет:

1. Настройте перенаправление портов на вашем маршрутизаторе:
   - Внешний порт (например, 8082) -> Внутренний порт 8082 на IP-адрес компьютера с TeleOko

2. Используйте сервис DDNS (динамический DNS), если у вас нет статического IP-адреса.

3. Для обеспечения безопасности рекомендуется:
   - Включить базовую аутентификацию (`auth.enabled: true`)
   - Использовать нестандартный порт (измените `server.port`)
   - Рассмотреть возможность настройки HTTPS (требуется дополнительная конфигурация)

## Устранение неполадок

### Не удается подключиться к камере

- Проверьте доступность камеры/NVR по сети: `ping [IP-адрес]`
- Убедитесь, что учетные данные в `config.json` верны
- Проверьте работу RTSP-потока через VLC: `rtsp://username:password@IP-адрес:554/Streaming/Channels/101`

### Видео не отображается в браузере

- Убедитесь, что браузер поддерживает WebRTC
- Проверьте консоль разработчика в браузере на наличие ошибок
- Возможно, ваш файрвол блокирует WebRTC-соединения

### Архивные записи не показываются

- Проверьте наличие записей на NVR за указанную дату
- Убедитесь, что используете правильный формат каналов
- Проверьте логи сервера на наличие ошибок при запросе к API Hikvision

## Лицензия

[MIT](LICENSE)